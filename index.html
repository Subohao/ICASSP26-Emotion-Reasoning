<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reasoning Beyond Majority Vote — Demo</title>
  <style>
    :root {
      --bg: #0f1116;
      --panel: #151823;
      --muted: #a8b0c0;
      --text: #e7ecf3;
      --good: #2eb87a;
      --warn: #e2b93d;
      --bad: #ef6b73;
      --accent: #6aa8ff;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    html, body { background: var(--bg); color: var(--text); margin: 0; font: 15px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    a { color: var(--accent); text-decoration: none; }
    header { padding: 24px 16px; border-bottom: 1px solid #23283a; background: linear-gradient(180deg, #111423, #0f1116); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 8px; }
    h1 { margin: 0 0 6px; font-weight: 700; letter-spacing: 0.2px; }
    .sub { color: var(--muted); }
    .controls { display: grid; gap: 8px; grid-template-columns: repeat(12, 1fr); align-items: center; padding: 14px 0 6px; }
    .controls > * { background: var(--panel); border: 1px solid #23283a; color: var(--text); padding: 8px 10px; border-radius: 10px; }
    .controls select, .controls input[type="search"] { width: 100%; }
    .controls .group { padding: 6px 10px; display: flex; gap: 12px; align-items: center; }
    .controls label { color: var(--muted); font-size: 13px; }
    .cards { display: grid; grid-template-columns: 1fr; gap: 12px; padding: 14px 0 40px; }
    @media (min-width: 960px){ .cards { grid-template-columns: 1fr; } }
    .card { background: var(--panel); border: 1px solid #23283a; border-radius: 14px; padding: 14px; }
    .toprow { display: flex; flex-wrap: wrap; gap: 8px 12px; align-items: center; justify-content: space-between; }
    .badges { display: flex; flex-wrap: wrap; gap: 6px; }
    .badge { font: 12px/1 var(--mono); color: #cdd6e5; padding: 6px 8px; border-radius: 10px; border: 1px solid #2a3147; background: #111524; }
    .badge.acc { background: #0f1523; }
    .muted { color: var(--muted); }
    details { background: #0f1422; border: 1px solid #212945; border-radius: 10px; margin-top: 10px; }
    details > summary { cursor: pointer; list-style: none; padding: 10px 12px; color: #d3dbeb; }
    details pre { margin: 0; padding: 12px; white-space: pre-wrap; word-break: break-word; border-top: 1px dashed #263153; font-family: var(--mono); font-size: 13px; color: #dfe6f5; }
    .cols { display: grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 960px){ .cols { grid-template-columns: repeat(3, 1fr); } }
    .model { border: 1px solid #23283a; border-radius: 10px; padding: 10px; background:#0f1320; }
    .model h4 { margin: 0 0 6px; font-size: 14px; letter-spacing: 0.2px; }
    .label { font-family: var(--mono); display: inline-block; padding: 3px 8px; border-radius: 8px; border: 1px solid #2a3147; background:#10162a; }
    .ok { color: var(--good); }
    .no { color: var(--bad); }
    .scoreboard { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px 0 0; }
    .score { border: 1px solid #23283a; border-radius: 10px; padding: 8px 10px; background:#0f1320; font-family: var(--mono); }
    .footer { color: var(--muted); font-size: 13px; padding: 20px 0 40px; }
    .sep { opacity: 0.35; padding: 0 6px; }
    .legend { font-size: 13px; color: var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Reasoning Comparisons — RBMV vs. Qwen2Audio‑CoT vs. Qwen2.5‑Omni‑CoT</h1>
      <div class="sub">Text‑only demo page for comparing predicted labels and rationales (open/closed form) with majority vs annotator‑aware scoring.</div>
      <div class="controls">
        <select id="dataset" title="Dataset" style="grid-column: span 3;">
          <option value="all">All datasets</option>
        </select>
        <select id="mode" title="Output mode" style="grid-column: span 3;">
          <option value="open">Open‑form</option>
          <option value="closed">Closed‑form</option>
        </select>
        <select id="scoring" title="Scoring" style="grid-column: span 3;">
          <option value="mv">Majority (plurality label)</option>
          <option value="aa">Annotator‑aware (any annotator)</option>
        </select>
        <input id="q" type="search" placeholder="Search transcript / rationale / id…" style="grid-column: span 3;" />
        <div class="group" style="grid-column: span 12; justify-content: space-between;">
          <div class="legend">Legend: <span class="sep">•</span><span class="ok">OK</span> = matches metric target; <span class="no">NO</span> = does not match.</div>
          <div class="legend">Toggle: <label><input type="checkbox" id="showTranscript" checked> Transcript</label> <label><input type="checkbox" id="showRationales" checked> Rationales</label></div>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="scoreboard" id="scoreboard"></div>
    <div class="cards" id="cards"></div>
    <div class="footer">This page is text‑only and static (no external libraries). Edit the JSON block at the bottom to add/remove samples or models. Scoring: Majority uses the corpus plurality label; Annotator‑aware (AA) counts a prediction correct if it matches any annotator label.</div>
  </main>

  <!-- ===================== DATA (Edit this block) ===================== -->
  <script type="application/json" id="demo-data">
  {
    "models": [
      {"key": "our", "name": "RBMV (ours)"},
      {"key": "q2audio", "name": "Qwen2Audio‑CoT"},
      {"key": "q2_5omni", "name": "Qwen2.5‑Omni‑CoT"}
    ],
    "samples": [
      {
        "id": "MSP_0001",
        "dataset": "MSP‑Podcast v1.12",
        "transcript": "Yeah… it’s fine, I guess. I’ll redo it later if that’s what you want.",
        "majority": "neutral",
        "annotators": ["neutral","sad","frustration"],
        "pred": {
          "our": {"open": {"label": "frustration", "rationale": "The speaker is talking about a person who was a founder of 4chan. The tone seems to be neutral, not overly excited or angry. The pitch doesn't seem to fluctuate much, indicating a calm delivery. There's no indication of strong emotions like surprise or contempt in the way the words are spoken. The clarity of the speech is good, so it's easy to understand what's being said. Overall, the speaker seems to be just stating a fact without showing any particular strong emotion. So, I think the emotion is neutral."}, "closed": {"label": "frustration", "rationale": "Low energy, shallow intonation; reluctant phrasing."}},
          "q2audio": {"open": {"label": "neutral", "rationale": "No explicit affect; plain statement."}, "closed": {"label": "neutral", "rationale": "Even tone."}},
          "q2_5omni": {"open": {"label": "sad", "rationale": "Soft voice; downward inflection suggests disappointment."}, "closed": {"label": "sad", "rationale": "Muted delivery; discouraged wording."}}
        }
      },
      {
        "id": "MSP_0002",
        "dataset": "MSP‑Podcast v1.12",
        "transcript": "Oh come on! We’ve talked about this a hundred times!",
        "majority": "angry",
        "annotators": ["angry","frustration"],
        "pred": {
          "our": {"open": {"label": "angry", "rationale": "Raised intensity, fast rate, emphatic \"come on\"."}, "closed": {"label": "angry", "rationale": "High energy and sharp onsets."}},
          "q2audio": {"open": {"label": "frustration", "rationale": "Complaint framing; exasperation."}, "closed": {"label": "frustration", "rationale": "Irritated tone."}},
          "q2_5omni": {"open": {"label": "angry", "rationale": "Harsh stress on \"hundred\"; clipped consonants."}, "closed": {"label": "angry", "rationale": "Strong emphasis; tense articulation."}}
        }
      },
      {
        "id": "MSP_0003",
        "dataset": "MSP‑Podcast v1.12",
        "transcript": "Thanks—that actually made my day.",
        "majority": "happy",
        "annotators": ["happy","neutral"],
        "pred": {
          "our": {"open": {"label": "happy", "rationale": "Upward contour, bright timbre; positive semantics."}, "closed": {"label": "happy", "rationale": "Smiling voice; quick tempo."}},
          "q2audio": {"open": {"label": "neutral", "rationale": "Polite statement."}, "closed": {"label": "neutral", "rationale": "Even tone."}},
          "q2_5omni": {"open": {"label": "happy", "rationale": "Warm tone; appreciative wording."}, "closed": {"label": "happy", "rationale": "Light, energetic delivery."}}
        }
      }
    ]
  }
  </script>

  <!-- ===================== LOGIC ===================== -->
  <script>
    const state = { mode: 'open', scoring: 'mv', dataset: 'all', q: '', showTranscript: true, showRationales: true };

    const data = JSON.parse(document.getElementById('demo-data').textContent);
    const cardsEl = document.getElementById('cards');
    const scoreboardEl = document.getElementById('scoreboard');

    // Populate dataset filter
    const ds = Array.from(new Set(data.samples.map(s => s.dataset)));
    const dsSel = document.getElementById('dataset');
    ds.forEach(d => { const o=document.createElement('option'); o.value=d; o.textContent=d; dsSel.appendChild(o); });

    // Controls
    function bind(id, handler){ document.getElementById(id).addEventListener('input', e => { handler(e.target.value); render(); }); }
    bind('mode', v => state.mode = v);
    bind('scoring', v => state.scoring = v);
    bind('dataset', v => state.dataset = v);
    bind('q', v => state.q = v.trim().toLowerCase());
    document.getElementById('showTranscript').addEventListener('change', e => { state.showTranscript = e.target.checked; render();});
    document.getElementById('showRationales').addEventListener('change', e => { state.showRationales = e.target.checked; render();});

    function matchesQuery(s){
      if(!state.q) return true;
      const hay = [s.id, s.dataset, s.transcript, ...data.models.map(m => (s.pred[m.key]?.[state.mode]?.rationale || ''))].join(' \u0000 ').toLowerCase();
      return hay.includes(state.q);
    }

    function filterSamples(){
      return data.samples.filter(s => (state.dataset==='all' || s.dataset===state.dataset) && matchesQuery(s));
    }

    function isCorrect(predLabel, sample){
      if(state.scoring === 'mv') return predLabel === sample.majority;
      // annotator-aware: any match in annotators set
      return sample.annotators.includes(predLabel);
    }

    function computeScores(samples){
      const scores = {};
      data.models.forEach(m => scores[m.key] = { ok: 0, total: 0 });
      samples.forEach(s => {
        data.models.forEach(m => {
          const out = s.pred[m.key]?.[state.mode];
          if(!out) return;
          scores[m.key].total++;
          if(isCorrect(out.label, s)) scores[m.key].ok++;
        });
      });
      return scores;
    }

    function renderScores(samples){
      const scores = computeScores(samples);
      scoreboardEl.innerHTML = '';
      data.models.forEach(m => {
        const sc = scores[m.key];
        const pct = sc.total ? (100*sc.ok/sc.total).toFixed(1) : '–';
        const div = document.createElement('div');
        div.className = 'score';
        div.textContent = `${m.name}: ${pct}% (${sc.ok}/${sc.total})`;
        scoreboardEl.appendChild(div);
      });
    }

    function renderCard(s){
      const card = document.createElement('div');
      card.className = 'card';
      const header = document.createElement('div');
      header.className = 'toprow';
      header.innerHTML = `
        <div>
          <strong>${s.id}</strong> <span class="sep">·</span> <span class="muted">${s.dataset}</span>
          <div class="badges" style="margin-top:6px;">
            <span class="badge">MV: <span class="label">${s.majority}</span></span>
            <span class="badge">All/AA: <span class="label">${[...new Set(s.annotators)].join(', ')}</span></span>
          </div>
        </div>
        <div class="badges">
          <span class="badge acc">Mode: ${state.mode}</span>
          <span class="badge acc">Scoring: ${state.scoring === 'mv' ? 'Majority' : 'Annotator‑aware'}</span>
        </div>`;
      card.appendChild(header);

      if(state.showTranscript){
        const det = document.createElement('details');
        det.open = true;
        det.innerHTML = `<summary>Transcript</summary><pre>${s.transcript}</pre>`;
        card.appendChild(det);
      }

      const cols = document.createElement('div');
      cols.className = 'cols';

      data.models.forEach(m => {
        const out = s.pred[m.key]?.[state.mode];
        const div = document.createElement('div');
        div.className = 'model';
        if(out){
          const ok = isCorrect(out.label, s);
          div.innerHTML = `
            <h4>${m.name}</h4>
            <div>Label: <span class="label ${ok?'ok':'no'}">${out.label} ${ok?'(OK)':'(NO)'}</span></div>
            ${state.showRationales ? `<details><summary>Rationale</summary><pre>${out.rationale}</pre></details>` : ''}
          `;
        } else {
          div.innerHTML = `<h4>${m.name}</h4><div class="muted">No ${state.mode} output provided.</div>`;
        }
        cols.appendChild(div);
      });

      card.appendChild(cols);
      return card;
    }

    function render(){
      const samples = filterSamples();
      renderScores(samples);
      cardsEl.innerHTML = '';
      samples.forEach(s => cardsEl.appendChild(renderCard(s)));
    }

    render();
  </script>
</body>
</html>
